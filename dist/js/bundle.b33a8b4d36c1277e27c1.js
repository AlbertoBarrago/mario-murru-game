(()=>{"use strict";var t={jump:new Audio("assets/sounds/jump.wav"),coin:new Audio("assets/sounds/coin.wav"),damage:new Audio("assets/sounds/damage.wav"),gameOver:new Audio("assets/sounds/game-over.wav"),levelComplete:new Audio("assets/sounds/level-complete.wav"),backgroundMusic:new Audio("assets/sounds/background.mp3")};function e(e){if(t[e]){t[e].currentTime=0;var i=t[e].play();void 0!==i&&i.catch((function(t){console.error("Error playing sound ".concat(e,":"),t),"NotAllowedError"===t.name&&console.warn("Sound autoplay was blocked by the browser. User interaction is required first.")}))}}t.backgroundMusic.loop=!0,t.backgroundMusic.volume=.5;var i=!1;function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function n(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(t){var e=function(t){if("object"!=r(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==r(e)?e:e+""}var a=function(){return t=function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i,this.width=32,this.height=32,this.velocityX=0,this.velocityY=0,this.isJumping=!1,this.direction="right",this.frame=0,this.frameCount=3,this.frameDelay=5,this.frameTimer=0,this.health=100,this.lives=3,this.invulnerable=!1,this.invulnerableTimer=0,this.invulnerableDuration=60,this.characterType="pepe"},i=[{key:"update",value:function(t,i,r){t.ArrowLeft||t.KeyA?(this.velocityX=-5,this.direction="left",this.frameTimer++):t.ArrowRight||t.KeyD?(this.velocityX=5,this.direction="right",this.frameTimer++):(this.velocityX*=.8,this.frameTimer=0,this.frame=0),(t.ArrowUp||t.KeyW||t.Space)&&!this.isJumping&&(this.velocityY=-15,this.isJumping=!0,e("jump")),t.KeyT&&!this.lastKeyT&&(this.characterType="pepe"===this.characterType?"mario":"pepe"),this.lastKeyT=t.KeyT,this.velocityY+=.5,this.velocityY>15&&(this.velocityY=15),this.x+=this.velocityX,this.y+=this.velocityY,this.x<0&&(this.x=0),this.x+this.width>i&&(this.x=i-this.width),this.y+this.height>r&&(this.y=r-this.height,this.velocityY=0,this.isJumping=!1),this.frameTimer>this.frameDelay&&(this.frame=(this.frame+1)%this.frameCount,this.frameTimer=0),this.invulnerable&&(this.invulnerableTimer++,this.invulnerableTimer>=this.invulnerableDuration&&(this.invulnerable=!1,this.invulnerableTimer=0))}},{key:"render",value:function(t){this.invulnerable&&Math.floor(Date.now()/100)%2==0&&(t.globalAlpha=.5);var e="pepe"===this.characterType?"pepe":"mario",i=0;this.isJumping?i=3:0!==this.velocityX&&(i=this.frame+1),"left"!==this.direction||this.isJumping||0!==this.velocityX||(i=4),this.invulnerable&&(i=5);var r=32*i;try{var n=new Image;n.src="assets/images/sprites/".concat(e,".svg"),t.drawImage(n,r,0,32,32,this.x,this.y,this.width,this.height)}catch(e){"pepe"===this.characterType?(t.fillStyle="#77b255",t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#000",t.fillRect(this.x+8,this.y+8,4,4),t.fillRect(this.x+20,this.y+8,4,4),t.beginPath(),t.arc(this.x+16,this.y+20,8,0,Math.PI,!1),t.stroke()):(t.fillStyle="#FFC0CB",t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#000",t.fillRect(this.x+8,this.y+8,4,4),t.fillRect(this.x+20,this.y+8,4,4),t.beginPath(),t.arc(this.x+16,this.y+20,5,0,Math.PI,!1),t.stroke())}t.globalAlpha=1}},{key:"takeDamage",value:function(t){return this.health-=t,this.invulnerable=!0,this.invulnerableTimer=0,e("damage"),this.health<=0}},{key:"reset",value:function(t,e){this.x=t,this.y=e,this.velocityX=0,this.velocityY=0,this.health=100}}],i&&n(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i}();function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function s(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,l(r.key),r)}}function l(t){var e=function(t){if("object"!=h(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=h(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==h(e)?e:e+""}var c=function(){return t=function t(e,i,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i,this.width=r,this.height=n,this.velocityX=o,this.direction=o>0?"right":"left",this.frame=0,this.frameCount=2,this.frameDelay=10,this.frameTimer=0},e=[{key:"update",value:function(t){this.x+=this.velocityX,(this.x<=0||this.x+this.width>=t)&&(this.velocityX*=-1,this.direction=this.velocityX>0?"right":"left"),this.frameTimer++,this.frameTimer>this.frameDelay&&(this.frame=(this.frame+1)%this.frameCount,this.frameTimer=0)}},{key:"render",value:function(t){var e=32*(0+this.frame);try{var i=new Image;i.src="assets/images/sprites/enemies.svg",t.drawImage(i,e,0,32,32,this.x,this.y,this.width,this.height)}catch(e){t.fillStyle="#ff0000",t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="#fff",t.fillRect(this.x+8,this.y+8,4,4),t.fillRect(this.x+20,this.y+8,4,4),t.strokeStyle="#000",t.lineWidth=2,t.beginPath(),t.moveTo(this.x+6,this.y+6),t.lineTo(this.x+12,this.y+10),t.stroke(),t.beginPath(),t.moveTo(this.x+26,this.y+6),t.lineTo(this.x+20,this.y+10),t.stroke()}}}],e&&s(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function f(t){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f(t)}function u(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,y(r.key),r)}}function y(t){var e=function(t){if("object"!=f(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=f(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==f(e)?e:e+""}var m=function(){return t=function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i,this.width=16,this.height=16,this.frame=0,this.frameCount=4,this.frameDelay=8,this.frameTimer=0,this.collected=!1},e=[{key:"update",value:function(){this.collected||(this.frameTimer++,this.frameTimer>this.frameDelay&&(this.frame=(this.frame+1)%this.frameCount,this.frameTimer=0))}},{key:"render",value:function(t){this.collected||(t.fillStyle="#ffd700",t.beginPath(),t.arc(this.x+this.width/2,this.y+this.height/2,this.width/2,0,2*Math.PI),t.fill())}}],e&&u(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,b(r.key),r)}}function g(t,e,i){return e&&p(t.prototype,e),i&&p(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function b(t){var e=function(t){if("object"!=d(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=d(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==d(e)?e:e+""}var w=new WeakMap,x=function(){return g((function t(){var e,i,r;v(this,t),e=this,i=w,r=function(){return g((function t(e,i,r,n,o,a,h){v(this,t),this.x=e,this.y=i,this.velocityX=r,this.velocityY=n,this.size=o,this.color=a,this.life=h,this.alpha=1,this.gravity=.1}),[{key:"update",value:function(){return this.x+=this.velocityX,this.y+=this.velocityY,this.velocityY+=this.gravity,this.life--,this.alpha=this.life/30,this.size*=.97,this.life>0}},{key:"render",value:function(t){t.globalAlpha=this.alpha,t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fill(),t.globalAlpha=1}}])}(),function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,i),i.set(e,r),this.particles=[]}),[{key:"createExplosion",value:function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:["#ff0000","#ff7700","#ffff00"],n=0;n<i;n++){var o=Math.random()*Math.PI*2,a=1+3*Math.random(),h=Math.cos(o)*a,s=Math.sin(o)*a,l=3+3*Math.random(),c=r[Math.floor(Math.random()*r.length)],f=20+20*Math.random();this.particles.push(new(y=this,(u=w).get(function(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}(u,y)))(t,e,h,s,l,c,f))}var u,y}},{key:"createScorePopup",value:function(t,e,i){this.scorePopups=this.scorePopups||[],this.scorePopups.push({x:t,y:e,score:i,life:40,velocityY:-1})}},{key:"update",value:function(){this.particles=this.particles.filter((function(t){return t.update()})),this.scorePopups&&(this.scorePopups=this.scorePopups.filter((function(t){return t.y+=t.velocityY,t.life--,t.life>0})))}},{key:"render",value:function(t){this.particles.forEach((function(e){return e.render(t)})),this.scorePopups&&(t.font="16px Arial",t.textAlign="center",this.scorePopups.forEach((function(e){var i=e.life/40;t.fillStyle="rgba(255, 255, 255, ".concat(i,")"),t.strokeStyle="rgba(0, 0, 0, ".concat(i,")"),t.lineWidth=2,t.fillText("+".concat(e.score),e.x,e.y),t.strokeText("+".concat(e.score),e.x,e.y)})),t.textAlign="left")}}])}();function A(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return S(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?S(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){h=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(h)throw o}}}}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}var T,k,E=!1,P=!1,M=1,j=0,R=!1,C={images:{},sounds:{},loaded:0,total:0},Y=[],I=[],O=[],X=document.getElementById("gameCanvas"),D=X.getContext("2d"),K={x:X.width-100,y:30},J={x:X.width-100,y:60},B={};function L(){C.loaded===C.total?(U(),document.getElementById("loading").style.display="none",E=!0,requestAnimationFrame(F)):setTimeout(L,100)}function U(){(T=new a(100,300)).lives=3,k=new x,Y.push({x:0,y:450,width:800,height:30}),Y.push({x:200,y:350,width:100,height:20}),Y.push({x:400,y:300,width:100,height:20}),Y.push({x:600,y:250,width:100,height:20}),I.push(new c(300,418,32,32,2));for(var t=0;t<5;t++)O.push(new m(150+120*t,300))}function F(i){var r;E&&(D.clearRect(0,0,X.width,X.height),P?R?(D.fillStyle="rgba(0, 0, 0, 0.7)",D.fillRect(0,0,X.width,X.height),D.fillStyle="#fff",D.font="48px Arial",D.textAlign="center",D.fillText("GAME OVER",X.width/2,X.height/2-40),D.font="24px Arial",D.fillText("Final Score: ".concat(j),X.width/2,X.height/2+10),D.font="18px Arial",D.fillText("Press R to restart",X.width/2,X.height/2+50),D.textAlign="left",B.KeyR&&(R=!1,M=1,j=0,U())):(gameRunning=!0,t.backgroundMusic.paused&&e("backgroundMusic"),T.update(B,X.width,X.height),I.forEach((function(t){return t.update(X.width)})),O.forEach((function(t){return t.update()})),k.update(),r=!1,Y.forEach((function(t){var e=Math.min(T.x+T.width,t.x+t.width)-Math.max(T.x,t.x),i=Math.min(T.y+T.height,t.y+t.height)-Math.max(T.y,t.y);e>0&&i>0&&(e<i?(T.x<t.x?T.x=t.x-T.width:T.x=t.x+t.width,T.velocityX=0):T.y<t.y?(T.y=t.y-T.height,T.velocityY=0,T.isJumping=!1,r=!0):(T.y=t.y+t.height,T.velocityY=0))})),r||(T.isJumping=!0),I.forEach((function(t,i){T.x+T.width>t.x&&T.x<t.x+t.width&&T.y+T.height>t.y&&T.y<t.y+t.height&&(T.velocityY>0&&T.y+T.height<t.y+t.height/2?(k.createExplosion(t.x+t.width/2,t.y+t.height/2,30,["#ff0000","#ff7700","#ffff00","#ff00ff"]),k.createScorePopup(t.x+t.width/2,t.y,20),I.splice(i,1),T.velocityY=-10,j+=20,e("damage")):T.invulnerable||T.takeDamage(25)&&(T.lives--,T.lives<=0?(R=!0,e("gameOver")):T.reset(100,300)))})),O.forEach((function(t){!t.collected&&T.x+T.width>t.x&&T.x<t.x+t.width&&T.y+T.height>t.y&&T.y<t.y+t.height&&(t.collected=!0,j+=10,e("coin"))})),q(),O.every((function(t){return t.collected}))&&(e("levelComplete"),M++,function(){T.reset(100,300),I=[],O=[],(Y=[]).push({x:0,y:450,width:800,height:30});for(var t=3+M,e=0;e<t;e++)Y.push({x:Math.random()*(X.width-100),y:150+250*Math.random(),width:70+100*Math.random(),height:20});for(var i=M,r=0;r<i;r++){var n=1+Math.random()*M;I.push(new c(100+Math.random()*(X.width-200),418,32,32,n))}for(var o=5+M,a=0;a<o;a++){for(var h=!1,s=void 0,l=void 0,f=0;!h&&f<50;){s=Math.random()*(X.width-50),l=100+300*Math.random(),h=!0;var u,y=A(Y);try{for(y.s();!(u=y.n()).done;){var d=u.value;if(s+16>d.x&&s<d.x+d.width&&l+16>d.y&&l<d.y+d.height){h=!1;break}}}catch(t){y.e(t)}finally{y.f()}f++}O.push(new m(h?s:50+50*a,h?l:100))}}())):q(),requestAnimationFrame(F))}function q(){D.fillStyle="#5c94fc",D.fillRect(0,0,X.width,X.height),D.fillStyle="#8b4513",Y.forEach((function(t){D.fillRect(t.x,t.y,t.width,t.height)})),O.forEach((function(t){return t.render(D)})),I.forEach((function(t){return t.render(D)})),T.render(D),k.render(D),function(){D.fillStyle="#000",D.fillRect(18,13,154,19),D.fillStyle="#fff",D.fillRect(20,15,150,15);var t=T.health/100*150;D.fillStyle=T.health>30?"#0f0":"#f00",D.fillRect(20,15,t,15),D.fillStyle="#000",D.font="12px Arial",D.fillText("HP: ".concat(T.health,"/100"),25,27),D.fillStyle="#f00",D.font="16px Arial",D.fillText("Lives: ".concat(T.lives),20,60),D.fillStyle="#000",D.font="16px Arial",D.fillText("Level: ".concat(M),K.x,K.y),D.fillStyle="#000",D.font="16px Arial",D.fillText("Score: ".concat(j),J.x,J.y)}()}window.onload=function(){var r;Object.values(t).forEach((function(e){e.load(),e.addEventListener("play",(function(){console.log("Playing sound: ".concat(Object.keys(t).find((function(i){return t[i]===e}))))})),e.addEventListener("error",(function(i){console.error("Error with sound: ".concat(Object.keys(t).find((function(i){return t[i]===e}))),i)}))})),r=[],C.total=r.length,r.forEach((function(t){var e=new Image;e.src=t.src,e.onload=function(){C.images[t.name]=e,C.loaded++},e.onerror=function(){console.error("Failed to load image: ".concat(t.src));var e=new Image;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII=",C.images[t.name]=e,C.loaded++}})),window.addEventListener("keydown",(function(r){var n;B[r.code]=!0,"KeyM"===r.code&&(i=!i,Object.values(t).forEach((function(t){t.muted=i}))),"KeyQ"===r.code&&P&&!R&&(t[n="backgroundMusic"]&&(t[n].pause(),t[n].currentTime=0),confirm("Are you sure you want to quit the game?")?(P=!1,gameRunning=!1,document.getElementById("startScreen").style.display="block",console.log("Game quit by user")):t.backgroundMusic.paused||e("backgroundMusic"))})),window.addEventListener("keyup",(function(t){B[t.code]=!1})),window.gameStarted=!1,window.gameRunning=!1,window.startGame=function(){P=!0,gameRunning=!0},L()}})();